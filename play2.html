<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Research Quest Game 2</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link rel="stylesheet" href="TemplateData/style.css">

  <style>
    body {
      margin:0;
      background:#fff;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      height:100vh;
    }
    #unity-container {
      width:100%;
      max-width:1100px;
      margin-top:20px;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    #unity-canvas {
      width:100% !important;
      height:700px !important;
      background:#000;
      border-radius:10px;
    }
    #unity-footer {
      margin-top:10px;
    }
  </style>
</head>

<body>

<!-- âœ… Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ù‚Ø¨Ù„ Unity -->
<script>
  window.receiveLessonData = function (lessonID, score, errors, timeSpent) {
    console.log("ðŸŸ¢ Unity â†’ Web Data Received", lessonID, score, errors, timeSpent);

    // Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ Firebase
    if (window.saveProgressToFirebase) {
      window.saveProgressToFirebase(lessonID, score, errors, timeSpent);
    }

    if (window.saveSessionData) {
      window.saveSessionData(lessonID, score, errors, timeSpent);
    }
  };
</script>

<div id="unity-container">
  <canvas id="unity-canvas"></canvas>

  <div id="unity-loading-bar">
    <div id="unity-logo"></div>
    <div id="unity-progress-bar-empty">
      <div id="unity-progress-bar-full"></div>
    </div>
  </div>

  <div id="unity-warning"></div>

  <div id="unity-footer">
    <div id="unity-webgl-logo"></div>
    <div id="unity-fullscreen-button"></div>
    <div id="unity-build-title">Research Quest Game 2</div>
  </div>
</div>

<!-- UNITY LOADER -->
<script>
  const canvas = document.querySelector("#unity-canvas");
  const loadingBar = document.querySelector("#unity-loading-bar");
  const progressBarFull = document.querySelector("#unity-progress-bar-full");
  const fullscreenButton = document.querySelector("#unity-fullscreen-button");
  const warningBanner = document.querySelector("#unity-warning");

  function unityShowBanner(msg, type) {
    const div = document.createElement("div");
    div.innerHTML = msg;
    div.style.padding = "10px";
    div.style.background = type === "error" ? "red" : "yellow";
    warningBanner.appendChild(div);
    setTimeout(() => warningBanner.removeChild(div), 5000);
  }

  /* âœ… Ù…Ø³Ø§Ø±Ùƒ Ù…Ø¶Ø¨ÙˆØ· */
  const buildUrl = "WebGL-Builds_Connector_1/WebGL-Builds/Build";
  const loaderUrl = buildUrl + "/WebGL-Builds.loader.js";

  const config = {
    dataUrl: buildUrl + "/WebGL-Builds.data",
    frameworkUrl: buildUrl + "/WebGL-Builds.framework.js",
    codeUrl: buildUrl + "/WebGL-Builds.wasm",
    streamingAssetsUrl: "StreamingAssets",
    companyName: "ResearchQuest",
    productName: "ResearchQuestGame2",
    productVersion: "1.0",
    showBanner: unityShowBanner
  };

  loadingBar.style.display = "block";

  const script = document.createElement("script");
  script.src = loaderUrl;

  script.onload = () => {
    createUnityInstance(canvas, config, progress => {
      progressBarFull.style.width = (progress * 100) + "%";
    }).then(unityInstance => {
      loadingBar.style.display = "none";
      fullscreenButton.onclick = () => unityInstance.SetFullscreen(1);
      window.unityInstance = unityInstance;
    }).catch(alert);
  };

  document.body.appendChild(script);

  document.addEventListener("click", () => {
    if (window.unityInstance?.Module?.audioContext?.state === "suspended") {
      window.unityInstance.Module.audioContext.resume();
    }
  }, { once: true });
</script>

</body>
</html>
