<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modules â€¢ Research Quest</title>

    <style>
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family: Arial, sans-serif;
        }

        body{
            background:#f5f7ef;
            min-height:100vh;
        }

        /* ================= NAVBAR ================= */
        header{
            background:#442C93;
            padding:14px 50px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            border-bottom:1px solid #eee;
        }

        .logo{
            font-weight:700;
            font-size:18px;
            color:#eee;
        }

        nav{
            display:flex;
            gap:30px;
        }

        nav a{
            color:#eee;
            text-decoration:none;
            font-weight:500;
        }

        nav a.active{
            color:#D1E231;
            font-weight:700;
        }

        .login{
            font-weight:600;
            text-decoration:none;
            color:#eee;
        }

        /* ================= CONTAINER ================= */
        .container{
            max-width:none;
            margin:40px auto;
            padding:20px;
            width: 100%;
        }

        .page-title{
            font-size:32px;
            margin-bottom:5px;
        }

        .page-sub{
            color:#666;
            margin-bottom:40px;
        }

        /* ================= LEVELS ================= */
        .levels{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
            gap:30px;
        }

        .level-card{
            background:#fffdf5;
            border-radius:20px;
            padding:30px;
            border:1px solid #d9e26f;
            position:relative;
            box-shadow:0 8px 20px rgba(0,0,0,0.05);
        }

        .level-card.locked{
            opacity:0.5;
        }

        .level-card.locked::after{
            content:"ðŸ”’ Locked";
            position:absolute;
            top:15px;
            right:15px;
            background:#ddd;
            padding:5px 12px;
            font-size:12px;
            border-radius:20px;
            font-weight:700;
        }

        .level-icon{
            font-size:30px;
            margin-bottom:15px;
        }

        .level-card h3{
            font-size:22px;
            margin-bottom:10px;
        }

        .level-card p{
            font-size:15px;
            color:#555;
            margin-bottom:20px;
            line-height:1.6;
        }

        /* ================= BUTTON ================= */
        .start-btn{
            width:100%;
            padding:12px;
            border:none;
            border-radius:30px;
            background:#442C93;
            color:#fff;
            font-size:16px;
            font-weight:600;
            cursor:pointer;
            
        }

        .start-btn.locked{
            background:#aaa;
            cursor:not-allowed;
        }

        /* ================= CHAT ICON ================= */
        .chat-icon {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 55px;
            height: 55px;
            background-color: #442C93;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 6px 15px #442C93;
            z-index: 1000;
        }

        /* ================= CHAT WRAPPER ================= */
        .chat-wrapper {
            position: fixed;
            bottom: 95px;
            right: 30px;
            width: 320px;
            height: 480px;
            background: #fafafa;
            border-radius: 20px;
            box-shadow: 0 15px 40px #442C93;
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 999;
        }

        .chat-header {
            background: #442C93;
            padding: 14px 18px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header-title {
            font-size: 15px;
            font-weight: 700;
        }

        .chat-header-sub {
            font-size: 12px;
            opacity: 0.8;
        }

        .close-btn {
            cursor: pointer;
            font-size: 20px;
        }

        #chatBox {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f7f7f0;
        }

        .msg {
            max-width: 85%;
            padding: 12px 14px;
            border-radius: 16px;
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.4;
        }

        .msg.user {
            background: #442C93;
            color: white;
            align-self: flex-end;
        }

        .msg.bot {
            background: #e6e6e6;
            color: #333;
            align-self: flex-start;
        }

        .input-area {
            padding: 12px;
            display: flex;
            gap: 10px;
            border-top: 1px solid #ddd;
            background: #f0f0f0;
        }

        #chatInput {
            flex: 1;
            padding: 10px 14px;
            border-radius: 20px;
            border: none;
            outline: none;
        }

        .send-btn {
            width: 40px;
            height: 40px;
            background: #442C93;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>

<body>

<header>
  <div class="logo">Research Quest</div>
  <nav>
    <a href="home.html">Home</a>
    <a href="dashboard1.html">Dashboard</a>
    <a href="modules.html" class="active">Modules</a>
  </nav>
  <a href="login.html" class="login">Log In</a>
</header>

<main class="container">
  <h1 class="page-title">Learning Levels</h1>
  <p class="page-sub">
    Progress through three comprehensive levels designed for your academic journey.
  </p>

  <div class="levels">

    <!-- BEGINNER -->
    <div class="level-card" id="level1">
      <div class="level-icon">ðŸŒ±</div>
      <h3>Beginner</h3>
      <p>
        <strong>The Trivia Engine â€“ The Defense</strong><br>
        Face fast-paced academic questions during a simulated thesis defense.
        Choose the correct answers, recognize key research concepts,and demonstrate accuracy.
      </p>

      <button class="start-btn" onclick="startLevel(1)">Start Level 1</button>
    </div>

    <!-- INTERMEDIATE -->
    <div class="level-card locked" id="level2">
      <div class="level-icon">ðŸ”¬</div>
      <h3>Intermediate</h3>
      <p>
        <strong>The Sequencer â€“ Logic of Discovery</strong><br>
        Learn how research develops step by step. Arrange the correct order
        of the research process and understand why planning and sequence
        are essential for studies.
      </p>

      <button class="start-btn locked" onclick="startLevel(2)">Locked</button>
    </div>

    <!-- ADVANCED -->
    <div class="level-card locked" id="level3">
      <div class="level-icon">ðŸŽ“</div>
      <h3>Advanced</h3>
      <p>
        <strong>The Error Hunter â€“ Peer Review</strong><br>
        Act as a peer reviewer and examine a research document carefully.
        Identify real academic errors, avoid traps, and strengthen your
        critical evaluation skills.
      </p>

      <button class="start-btn locked" onclick="startLevel(3)">Locked</button>
    </div>

  </div>
</main>

<!-- Chatbot Icon -->
<div class="chat-icon" onclick="toggleChatbot()">ðŸ’¬</div>

<!-- Chatbot Wrapper -->
<div class="chat-wrapper" id="chatWrapper">
    <div class="chat-header">
        <div>
            <div class="chat-header-title">Research Assistant</div>
            <div class="chat-header-sub">Always here to help</div>
        </div>
        <div class="close-btn" onclick="toggleChatbot()">Ã—</div>
    </div>
    <div id="chatBox"></div>
    <div class="input-area">
        <input type="text" id="chatInput" placeholder="Ask me anything...">
        <button class="send-btn" id="sendBtn">âž¤</button>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBS6WZ13DKVvbdddE-azZrI2FuBrSe39u0",
    authDomain: "login-1aba2.firebaseapp.com",
    projectId: "login-1aba2",
    storageBucket: "login-1aba2.appspot.com",
    messagingSenderId: "393759404087",
    appId: "1:393759404087:web:9581fde1afb9ca81decfb2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const PASS_THRESHOLD = 60;

  // Ù†ÙØ³ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ØªÙ…Ø§Ù…Ø§Ù‹
  const beginnerLevels = ["Default_Config_Trivia"];
  const intermediateLevels = ["Default_Config_Sequencer"];
  const advancedLevels = ["Default_Config_ErrorHunter"];

  onAuthStateChanged(auth, async (user) => {
    if (!user) return;

    const snap = await getDoc(doc(db, "progress", user.uid));
    const progress = snap.exists() ? snap.data() : {};

    const scores = {
      beginner: progress[beginnerLevels[0]]?.score || 0,
      intermediate: progress[intermediateLevels[0]]?.score || 0,
      advanced: progress[advancedLevels[0]]?.score || 0
    };

    // === Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ===
    if (scores.beginner >= PASS_THRESHOLD) {
      unlock("level2", "Start Level 2");
    }

    if (scores.intermediate >= PASS_THRESHOLD) {
      unlock("level3", "Start Level 3");
    }
  });

  function unlock(levelId, text) {
    const card = document.getElementById(levelId);
    if (!card) return;

    const btn = card.querySelector(".start-btn");
    card.classList.remove("locked");
    if (btn) {
      btn.classList.remove("locked");
      btn.innerText = text;
    }
  }

  window.startLevel = function(level) {
    const card = document.getElementById(`level${level}`);
    if (card.classList.contains("locked")) {
      alert("Please complete the previous level with 70+ to unlock this level.");
      return;
    }
    window.location.href = `level${level}.html`;
  };
</script>


<!-- âœ… Chatbot Script -->
<script src="chatbot.js"></script> 

</body>
</html>
